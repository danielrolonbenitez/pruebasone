<?include_once("init.php");include_once("define.php");if(!empty($_GET['id'])) $id = $_GET['id'];$_GET['pasado'] = 1;if ($_GET['autocompete'] == 1) {	$q = $_GET['q'];	$sql = "select * from federaciones f 			inner join d_ciudad ciu on f.fed_id_ciudad=ciu.id_ciudad 			inner join d_provincia pro on ciu.id_provincia=pro.id_provincia 			order by f.fed_nombre asc ";	$query = mysql_query($sql);	echo mysql_error();	while ($dat = mysql_fetch_array($query)) {		$id = 500000 + $dat[id_federacion];		$k = "$dat[fed_abreviacion] - ".utf8_decode($dat[fed_nombre]) ." - " . "$dat[desc_ciudad] - $dat[desc_provincia]";		$items[$k] = $id;	}		$sql = "select * from camaras c 			inner join d_ciudad ciu on c.cam_id_ciudad=ciu.id_ciudad 			inner join d_provincia pro on ciu.id_provincia=pro.id_provincia 			order by c.cam_nombre asc ";	$query = mysql_query($sql);	echo mysql_error();	while ($dat = mysql_fetch_array($query)) {		$id = $dat[id_camara];		$k = "$dat[cam_abreviacion] -  ".utf8_decode($dat[cam_nombre])." - " . "$dat[desc_ciudad] - $dat[desc_provincia]";		$items[$k] = $id;	}	foreach($items as $key => $value) {		if (strpos(strtolower($key), $q) !== false)			echo "$key|$value\n";	}}if($_GET['oper'] == "showinfo") {	if($_GET['iscam'] == "true") {		$sql = "select * from camaras c 	inner join d_ciudad ciu on c.cam_id_ciudad=ciu.id_ciudad 	inner join d_provincia pro on ciu.id_provincia=pro.id_provincia 	left join rel_cam_fed r on r.id_camara=c.id_camara 	left join federaciones f on f.id_federacion=r.id_federacion 		where c.id_camara='$_GET[id]'";		$query = mysql_query($sql);		echo mysql_error();		$dat = mysql_fetch_assoc($query);		$web2 = str_replace("http://", "", $dat[cam_web]);		$web = ($web2 == "") ? "No Disponible" : "<a href='http://$web2' target='_blank'>http://$web2</a>";		$tel = ($dat[cam_telefono] > '') ? $dat[cam_telefono] : "No Disponible";		$fax = ($dat[cam_fax] > '') ? $dat[cam_fax] : "No Disponible";		$email = (strlen(trim($dat[cam_email])) > 0) ? "<a href='mailto:$dat[cam_email]' target='_blank'>$dat[cam_email]</a>" : 'No Disponible';		echo "<input type='hidden' id='idcam' iscam='true' value='$_GET[id]'>";		// datos			//echo "<img src='images/circulo_grande_verde.png' style='position: absolute; left: 20px; top:23px;'>";		echo '<div class="lp-title">Resultados <a class="volver" href="">Volver</a></div>';		echo '<div class="top-line-chamber"></div>';		echo "<div class='titulo'>";				if(preg_match('/[a-zA-Z]/', $dat['cam_abreviacion'])) echo $dat['cam_abreviacion'] . "<br>";						echo utf8_decode($dat['cam_nombre']);		echo "</div>";		$dat['id_federacion'] = 0;		if ($dat[id_federacion] > 0)			echo "<div class='perteneciente'>Perteneciente a la Federación <b>".utf8_decode($dat[fed_nombre])."</b></div>";		echo "<div class='datos'>".utf8_decode($dat[cam_calle]." ". $dat[cam_calle_numero]." ". $dat[cam_of]).", " . $dat[desc_ciudad]. ", " . $dat[desc_provincia] . ".<br />Telefono: $tel | Fax: $fax<br>Email: $email | Página: $web</div>";		if ($dat[cam_descripcion] > '')			echo "<div class='obs'>$dat[cam_descripcion]</div>";		// integrantes ///		$q = mysql_query("select * from comisiones where id_camara='$_GET[id]'");		$r = mysql_num_rows($q);		if ($r > 0) {			echo "<span class='integrantes'><img src='images/person1.png' align='middle'>&nbsp;Mostrar Integrantes de la Cámara</span>";			echo "<div id='integrantes'>";			while ($d = mysql_fetch_assoc($q)) {				echo "<div class='int'><b>$d[nombre]</b> - $d[cargo]";				if ($d[email] > '')					echo ". Email: <a href='mailto:$d[email]'>$d[email]</a>";				echo "</div>";			}			echo '</div>';		}		/*echo '<div id="eventos"><span class="titloevento">Eventos y Actividades</span>		<div id="buscadoreventos">	Categoría <select id="categoria">			<option value="0">< Todas ></option>			<option value="1">Sensibilización</option>			<option value="2">Capacitación</option>			<option value="3">Asistencia</option>		</select>							<input type="text" id="txtevento"><input type="button" value="Buscar" id="buscarevento">&nbsp;&nbsp;<input type="checkbox" id="pasado" name="pasado" value="1"> Incluir eventos pasados			</div>	<div class="htmleventos"><div id="htmleventos"></div></div>	</div>';*/				echo '<div id="eventos"><span class="titloevento">Eventos y Actividades</span>		<div id="buscadoreventos">	Categoría <select id="categoria" style="display: none">			<option value="0">< Todas ></option>			<option value="1">Sensibilización</option>			<option value="2">Capacitación</option>			<option value="3">Asistencia</option>		</select>				<input type="text" placeholder="Buscar" id="txtevento">&nbsp;&nbsp;	</div>	<div class="htmleventos"><div id="htmleventos"></div></div>	</div>';	} // endif		// federacion	else {/*<!--<input type="checkbox" id="pasado" name="pasado" value="1"><label for="pasado" class="ep-ep">Eventos pasados</label>!-->				*/		$sql = "select * from federaciones f 	inner join d_ciudad ciu on f.fed_id_ciudad=ciu.id_ciudad 	inner join d_provincia pro on ciu.id_provincia=pro.id_provincia 	where f.id_federacion='$_GET[id]'";		$query = mysql_query($sql);		echo mysql_error();		$dat = mysql_fetch_assoc($query);		$web2 = str_replace("http://", "", $dat[fed_web]);		$web = ($web2 == "") ? "No Disponible" : "<a href='http://$web2' target='_blank'>http://$web2</a>";		$tel = ($dat[fed_telefono] > '') ? $dat[fed_telefono] : "No Disponible";		$fax = ($dat[fed_fax] > '') ? $dat[fed_fax] : "No Disponible";		$email = (strlen(trim($dat[fed_email])) > 0) ? "<a href='mailto:$dat[fed_email]' target='_blank'>$dat[fed_email]</a>" : 'No Disponible';		echo "<input type='hidden' id='idcam' iscam='false' value='$_GET[id]'>";		// datos			//echo "<img src='images/circulo_grande_azul.png' style='position: absolute; left: 20px; top:23px;'>";		echo '<div class="lp-title">Resultados <a class="volver" href="">Volver</a></div>';		echo '<div class="top-line-federation"></div>';		echo "<div class='titulo'>";		if(preg_match('/[A-Za-z]/', $dat['fed_abreviacion'])) echo utf8_decode($dat[fed_abreviacion]) . "<br>";				echo utf8_decode($dat['fed_nombre']);		echo "</div>";		echo "<div class='datos'>".utf8_decode($dat[fed_calle]." ". $dat[fed_calle_numero]." ". $dat[fed_of])."," . utf8_encode("$dat[desc_ciudad], $dat[desc_provincia]") . ".<br />Telefono: $tel | Fax: $fax<br>Email: $email | Página: $web</div>";		if ($dat[fed_descripcion] > '')			echo "<div class='obs'>".utf8_decode($dat[fed_descripcion])."</div>";		// integrantes ///		$q = mysql_query("select * from comisiones where id_federacion='$dat[id_federacion]'");		$r = mysql_num_rows($q);		if ($r > 0) {			echo "<span class='integrantes'><img src='images/person1.png' align='middle'>&nbsp;Mostrar Integrantes de la Federación</span>";			echo "<div id='integrantes'>";			while ($d = mysql_fetch_assoc($q)) {				echo "<div class='int'><b>$d[nombre]</b> - $d[cargo]";				if ($d[email] > '')					echo ". Email: <a href='mailto:$d[email]'>$d[email]</a>";				echo "</div>";			}			echo '</div>';		}		/*echo '<div id="eventos"><span class="titloevento">Eventos y Actividades</span>		<div id="buscadoreventos">	Categoría <select id="categoria">			<option value="0">< Todas ></option>			<option value="1">Sensibilización</option>			<option value="2">Capacitación</option>			<option value="3">Asistencia</option>		</select>		<input type="text" id="txtevento"> <input type="button" value="Buscar" id="buscarevento">&nbsp;&nbsp;<input type="checkbox" id="pasado" name="pasado" value="1"> Incluir eventos pasados			</div>	<div class="htmleventos"><div id="htmleventos"></div></div>	</div>	<script type="text/javascript">$("#categoria").customSelect();</script>	';*/				echo '<div id="eventos"><span class="titloevento">Eventos y Actividades</span>		<div id="buscadoreventos">	Categoría <select style="display: none" id="categoria">			<option value="0">< Todas ></option>			<option value="1">Sensibilización</option>			<option value="2">Capacitación</option>			<option value="3">Asistencia</option>		</select>		<input type="text" id="txtevento">&nbsp;&nbsp;<input type="checkbox" id="pasado" name="pasado" value="1"><label for="pasado" class="ep-ep">Eventos pasados</label>			</div>	<div class="htmleventos"><div id="htmleventos"></div></div>	</div>';	}}if ($_GET['oper'] == "showeventos") {	$campo = ($_GET['iscam'] == "true") ? "id_camara" : "id_federacion";	$w.=($_GET[pasado] == 1) ? "" : " and fecha>=now() ";	$w.=($_GET[cat]) ? " and id_categoria='$_GET[cat]' " : "";	if ($_GET[txt] > '') {		$t = trim($_GET[txt]);		$w.="and (titulo like '%$t%' or lugar like '%$t%' or desc_larga like '%$t%') ";	}	if ($cat > 0 || $_GET[pasado] == 1 || $_GET[txtevento] > '')		$segun = " según su criterio de búsqueda";	$where = " where $campo='$_GET[id]' $w ";	$query = mysql_query("select * from eventos $where order by fecha desc");			$row = mysql_num_rows($query);	if ($row == 0) {		echo "<div align='center'><div id='anuncio'>No hay eventos registrados" . "$segun.</div></div>";		exit;	}	$posicionActual = 0;	while ($dat = mysql_fetch_array($query)) {		$posicionActual++;		$linkx = str_replace("http://", "", $dat[8]);		if (trim($linkx) > '')			$linkx = "http://" . $linkx;		// lugar		$f = explode("-", $dat[fecha]);		$f = ($dat[fecha]) ? "Fecha: " . $f[2] . "/" . $f[1] . "/" . $f[0] : " No definido";		$h = ($dat[hora] > "") ? ". Horario: $dat[hora]" : " Consulte";		$l = ($dat[lugar] > "") ? ". Lugar: ". utf8_encode($dat[lugar])."" : " Consulte.";		$fechahoralugar = $f . $h . $l;		$idd++;		switch ($dat[id_categoria]) {			case 1: $catstr = "Sensibilización";				$cattitle = 'Actividades de Sensibilización dirigidas a mejorar la competitividad de las PYMES en ejes comerciales';				break;			case 2: $catstr = "Capacitación";				$cattitle = 'Actividades de Capacitación para fortalecer la gestión de las PYMES comerciales y de servicios';				break;			case 3: $catstr = "Asistencia";				$cattitle = 'Actividades de Asistencia técnica dirigidas a incrementar la competitividad de las PYMES comerciales y de servicios';				break;		}			if($posicionActual == 1){			$idItem = $_GET['id'];			if($_GET['iscam'] == "true"){				$tipoDato = 'camara';			}			else {				$tipoDato = 'federacion';			}			echo '<div style="float:right;"><a href="imprime.php?id='.$idItem.'&tipo='.$tipoDato.'" target="_blank"><img src="img/printer.png" border=0></a></div><div style="clear:both"></div>';		}		echo "<div id='eventocontent'>";		echo "<span class='categoriaevento ";		echo strtolower(preg_replace('/[^a-zA-Z]/', '', $catstr));		echo "' title='$cattitle'>$catstr</span><div class='tituloevento'>".$dat[titulo]."</div>";		echo "<div class='textocortoevento'>".$dat[desc_corta]."<span class='leer' onclick='$(this).parent().hide(); $(\"*[oculto=$idd]\").show();'>&nbsp[+] AMPLIAR.</span></div>";		echo "<div class='textolargoevento' oculto='$idd'>" .nl2br($dat[desc_larga]) . "<span class='leer' onclick='$(this).parent().prev().show(); $(this).parent().hide();'>&nbsp[-] REDUCIR.</span></div>";		/* //		  //			echo '<a href="'.$dat[img].'" rel="facebox"><img   style="margin: 5px 5px 5px 0; border:0"  src="'.$dat[img].'" class="img_th_evento" title="click para ampliar"></a>'; */if (trim($dat[img]) > "")//echo "<input type='button' value='Ver Galería de Fotos' onclick='window.open(\"$dat[img]\")'>";		$kj=0;		if($dat[img]):				$gallery = explode(',',$dat[img]);				//var_dump($gallery);?>				<?php foreach($gallery as $gal):?>					<a class="gallery cboxElement" rel="gallery-<?php echo strtolower(str_replace(" ","",$dat[titulo])); ?>" style="margin-left:10px;" href="<?php echo $gal; ?>"><img src="<?php echo $gal; ?>" /></a>				<?php  $kj++; endforeach;		endif; 		?>		<?php		echo "<div class='fechahoralugar'>".utf8_decode($fechahoralugar)."</div>";		if ($linkx > "")			echo "<div class='linkevento'>Mas información: <a href='$linkx' target='_blank'>$linkx</a></div>";		echo "</div>";	}}if ($_GET[oper] == "showeventosGral") {	$w.=($_GET[pasado] == 1) ? "" : " and fecha>=now() ";	$w.=($_GET[cat]) ? " and id_categoria='$_GET[cat]' " : "";	if ($_GET[txt] > '') {		$t = trim($_GET[txt]);		$w.="and (e.titulo like '%$t%' or e.lugar like '%$t%' or e.desc_larga like '%$t%') ";	}	if ($cat > 0 || $_GET[pasado] == 1 || $_GET[txtevento] > '')		$segun = " según su criterio de búsqueda";	$where = " where e.id_evento>0 $w ";	$sql = "select * from eventos  e			left join camaras c on c.id_camara=e.id_camara 			left join federaciones f on f.id_federacion=e.id_federacion 			$where  order by e.fecha desc  limit 100";	$query = mysql_query($sql);	echo mysql_error();	$row = mysql_num_rows($query);	if ($row == 0) {		echo "<div align='center'><div id='anuncio'>No hay eventos registrados" . "$segun.</div></div>";		exit;	}	while ($dat = mysql_fetch_array($query)) {		$realizador = ($dat[id_camara] > 0) ? "<img src='images/dots/circulo_chico_verde.png'>$dat[cam_nombre] ($dat[cam_abreviacion])" : "<img src='images/circulo_chico_azul.png'>$dat[fed_nombre] ($dat[fed_abreviacion])";		$linkx = str_replace("http://", "", $dat[8]);		if (trim($linkx) > '')			$linkx = "http://" . $linkx;		// lugar		$f = explode("-", $dat[fecha]);		$f = ($dat[fecha]) ? "Fecha: " . $f[2] . "/" . $f[1] . "/" . $f[0] : " No definido";		$h = ($dat[hora] > "") ? ". Horario: $dat[hora]" : " Consulte";		$l = ($dat[lugar] > "") ? ". Lugar: ".utf8_encode($dat[lugar]) :" Consulte.";		$fechahoralugar = $f . $h . $l;		$idd++;		switch ($dat[id_categoria]) {			case 1: $catstr = "Sensibilización";				$cattitle = 'Actividades de Sensibilización dirigidas a mejorar la competitividad de las PYMES en ejes comerciales';				break;			case 2: $catstr = "Capacitación";				$cattitle = 'Actividades de Capacitación para fortalecer la gestión de las PYMES comerciales y de servicios';				break;			case 3: $catstr = "Asistencia";				$cattitle = 'Actividades de Asistencia técnica dirigidas a incrementar la competitividad de las PYMES comerciales y de servicios';				break;		}		echo "<div id='eventocontent'>";		echo "<div style='font-size:14px; color: #666; margin-bottom: 4px'>$realizador</div>";		echo "<span class='categoriaevento' title='$cattitle'><div class='tituloevento'>$catstr</span> $dat[titulo]</div>";		echo "<div class='textocortoevento'>$dat[desc_corta]<span class='leer' onclick='$(this).parent().hide(); $(\"*[oculto=$idd]\").show();'>&nbsp[+] AMPLIAR.</span></div>";		echo "<div class='textolargoevento' oculto='$idd'>" . nl2br($dat[desc_larga]) . "<span class='leer' onclick='$(this).parent().prev().show(); $(this).parent().hide();'>&nbsp[-] REDUCIR.</span></div>";		/* 	if(trim($dat[img])>"")		  echo '<a href="'.$dat[img].'" rel="facebox"><img   style="margin: 5px 5px 5px 0; border:0"  src="'.$dat[img].'" class="img_th_evento" title="click para ampliar"></a>'; */if (trim($dat[img]) > "")//echo "<input type='button' value='Ver Galería de Fotos' onclick='window.open(\"$dat[img]\")'>";		$kj=0;		if($dat[img]):				$gallery = explode(',',$dat[img]);				//var_dump($gallery);?>				<?php foreach($gallery as $gal):?>					<a class="gallery cboxElement" rel="gallery-<?php echo strtolower(str_replace(" ","",$dat[titulo])); ?>" style="margin-left:10px;" href="<?php echo $gal; ?>"><img src="<?php echo $gal; ?>" /></a>				<?php  $kj++; endforeach;		endif; 		?>				<?php		echo "<div class='fechahoralugar'>$fechahoralugar</div>";		if ($linkx > "")			echo "<div class='linkevento'>Mas información: <a href='$linkx' target='_blank'>$linkx</a></div>";		echo "</div>";	}}if($_GET['oper'] == "picasa") {	$zend_path = dirname(__FILE__) . DIRECTORY_SEPARATOR . 'library';	set_include_path(get_include_path() . PATH_SEPARATOR . $zend_path);		//$_REQUEST['url'] = 'https://picasaweb.google.com/camemap/TITINARECONQUISTA';	//$_REQUEST['url'] = 'https://picasaweb.google.com/100742160751246668876/PruebaAlbum';	 	$url = explode('?', $_REQUEST['url']);	$url = explode('#', $url[0]);	$url = $url[0];	$url = preg_replace('/\/$/', '', $url);	$url = explode("/", $url);	$album_name = $url[count($url) - 1];	$user_name = $url[count($url) - 2];		/*var_dump($album_name);	var_dump($user_name);	die();*/	require_once "Zend/Loader.php";	require_once "Zend/Gdata.php";	require_once "Zend/Gdata/Photos.php";	require_once "Zend/Gdata/Photos/AlbumQuery.php";	require_once "Zend/Gdata/ClientLogin.php";			$serviceName = Zend_Gdata_Photos::AUTH_SERVICE_NAME;	$user = 'camemap@gmail.com';	$pass = 'facundo21';	$client = Zend_Gdata_ClientLogin::getHttpClient($user, $pass, $serviceName, null,    Zend_Gdata_ClientLogin::DEFAULT_SOURCE, null, null,    Zend_Gdata_ClientLogin::CLIENTLOGIN_URI, 'GOOGLE');	$service = new Zend_Gdata_Photos($client);	$query = new Zend_Gdata_Photos_AlbumQuery();	$query->setUser($user_name);	$query->setAlbumName($album_name);	try {		$album = $service->getAlbumFeed($query);		$data = array();		foreach($album as $entry) {			$thumbnail = $entry->getMediaGroup()->getThumbnail();			$content = $entry->getMediaGroup()->getContent();			$data[] = array(				'thumbnail' => $thumbnail[0]->getUrl(),				'photo' => $content[0]->getUrl()			);			/*var_dump($entry->getMediaGroup()->getContent()[0]->getUrl());*/		}		echo json_encode($data);	}	catch (Zend_Gdata_App_Exception $e) {		$error = array('error' => $e->getMessage());		echo json_encode($error);	}	die();}?>